<div class="max-w-4xl mx-auto p-6">
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">Add New Recipe</h1>
    <p class="mt-2 text-gray-600">Fill in the details below to create a new recipe.</p>
  </div>

  <!-- Error Alert -->
  @if (errorMessage()) {
    <div class="mb-6 bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg" role="alert">
      <p class="font-medium">Error creating recipe</p>
      <p class="text-sm">{{ errorMessage() }}</p>
    </div>
  }

  <!-- Form -->
  <form [formGroup]="recipeForm" (ngSubmit)="onSubmit()" class="space-y-6">

    <!-- Name Field -->
    <div>
      <label for="name" class="block text-sm font-medium text-gray-700 mb-1">
        Name <span class="text-red-600">*</span>
      </label>
      <input
        type="text"
        id="name"
        formControlName="name"
        class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        [class.border-red-500]="hasError('name')"
        [class.border-gray-300]="!hasError('name')"
        placeholder="e.g., Chocolate Chip Cookies"
        [attr.aria-invalid]="hasError('name')"
        [attr.aria-describedby]="hasError('name') ? 'name-error' : null"
      />
      @if (hasError('name')) {
        <p id="name-error" class="mt-1 text-sm text-red-600">{{ getErrorMessage('name') }}</p>
      }
    </div>

    <!-- Description Field -->
    <div>
      <label for="description" class="block text-sm font-medium text-gray-700 mb-1">
        Description <span class="text-red-600">*</span>
      </label>
      <textarea
        id="description"
        formControlName="description"
        rows="3"
        class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        [class.border-red-500]="hasError('description')"
        [class.border-gray-300]="!hasError('description')"
        placeholder="A brief description of the recipe"
        [attr.aria-invalid]="hasError('description')"
        [attr.aria-describedby]="hasError('description') ? 'description-error' : null"
      ></textarea>
      @if (hasError('description')) {
        <p id="description-error" class="mt-1 text-sm text-red-600">{{ getErrorMessage('description') }}</p>
      }
    </div>

    <!-- Time Fields Row -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- Prep Time -->
      <div>
        <label for="prepTime" class="block text-sm font-medium text-gray-700 mb-1">
          Prep Time (minutes) <span class="text-red-600">*</span>
        </label>
        <input
          type="number"
          id="prepTime"
          formControlName="prepTime"
          min="0"
          class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          [class.border-red-500]="hasError('prepTime')"
          [class.border-gray-300]="!hasError('prepTime')"
          [attr.aria-invalid]="hasError('prepTime')"
          [attr.aria-describedby]="hasError('prepTime') ? 'prepTime-error' : null"
        />
        @if (hasError('prepTime')) {
          <p id="prepTime-error" class="mt-1 text-sm text-red-600">{{ getErrorMessage('prepTime') }}</p>
        }
      </div>

      <!-- Cook Time -->
      <div>
        <label for="cookTime" class="block text-sm font-medium text-gray-700 mb-1">
          Cook Time (minutes) <span class="text-red-600">*</span>
        </label>
        <input
          type="number"
          id="cookTime"
          formControlName="cookTime"
          min="0"
          class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          [class.border-red-500]="hasError('cookTime')"
          [class.border-gray-300]="!hasError('cookTime')"
          [attr.aria-invalid]="hasError('cookTime')"
          [attr.aria-describedby]="hasError('cookTime') ? 'cookTime-error' : null"
        />
        @if (hasError('cookTime')) {
          <p id="cookTime-error" class="mt-1 text-sm text-red-600">{{ getErrorMessage('cookTime') }}</p>
        }
      </div>
    </div>

    <!-- Difficulty Dropdown -->
    <div>
      <label for="difficulty" class="block text-sm font-medium text-gray-700 mb-1">
        Difficulty <span class="text-red-600">*</span>
        <span class="text-gray-500 font-normal text-xs ml-2">(1-2 Easy, 3-4 Medium, 5 Hard)</span>
      </label>
      <select
        id="difficulty"
        formControlName="difficulty"
        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        [attr.aria-invalid]="hasError('difficulty')"
      >
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
      @if (hasError('difficulty')) {
        <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('difficulty') }}</p>
      }
    </div>

    <!-- Instructions Field (Markdown) -->
    <div>
      <label for="instructions" class="block text-sm font-medium text-gray-700 mb-1">
        Instructions <span class="text-red-600">*</span>
        <span class="text-gray-500 font-normal text-xs ml-2">(Markdown supported)</span>
      </label>
      <textarea
        id="instructions"
        formControlName="instructions"
        rows="10"
        class="w-full px-3 py-2 border rounded-md font-mono text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        [class.border-red-500]="hasError('instructions')"
        [class.border-gray-300]="!hasError('instructions')"
        placeholder="Enter step-by-step instructions. You can use Markdown formatting:&#10;&#10;1. First step&#10;2. Second step&#10;   - Sub-point&#10;&#10;**Bold text** or *italic text*"
        [attr.aria-invalid]="hasError('instructions')"
        [attr.aria-describedby]="hasError('instructions') ? 'instructions-error instructions-hint' : 'instructions-hint'"
      ></textarea>
      <p id="instructions-hint" class="mt-1 text-xs text-gray-500">
        You can use Markdown syntax for formatting (e.g., **bold**, *italic*, lists)
      </p>
      @if (hasError('instructions')) {
        <p id="instructions-error" class="mt-1 text-sm text-red-600">{{ getErrorMessage('instructions') }}</p>
      }
    </div>

    <!-- Form Actions -->
    <div class="flex items-center justify-end gap-4 pt-6 border-t border-gray-200">
      <button
        type="button"
        (click)="onCancel()"
        [disabled]="isSubmitting()"
        class="px-6 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
        [class.opacity-50]="isSubmitting()"
        [class.cursor-not-allowed]="isSubmitting()"
      >
        Cancel
      </button>
      <button
        type="submit"
        [disabled]="isSubmitting()"
        class="px-6 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
        [class.opacity-50]="isSubmitting()"
        [class.cursor-not-allowed]="isSubmitting()"
      >
        @if (isSubmitting()) {
          <span class="flex items-center gap-2">
            <ng-icon name="matRefresh" class="animate-spin h-4 w-4" />
            Creating...
          </span>
        } @else {
          Create Recipe
        }
      </button>
    </div>
  </form>
</div>
